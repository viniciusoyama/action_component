env:
  global:
    - CC_TEST_REPORTER_ID=2373c9fa7226b98ccf8bef72f133bc37b4cef57085c027e144a3b2fc71ce7558
  matrix:
    - "RAILS_VERSION=4.2.0"
    - "RAILS_VERSION=5.0.0"
    - "RAILS_VERSION=5.1.0"
    - "RAILS_VERSION=5.2.0"

language: ruby

cache:
  bundler: true

rvm:
 - "2.4.1"

bundler_args: "--binstubs --standalone --without documentation --path ../bundle"

before_install:
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter

before_script:
  - ./cc-test-reporter before-build

script:
  - bundle exec rubocop -c .rubocop.yml
  - bundle exec rspec

notifications:
  email: false

after_script:
  - if [[ "$TRAVIS_TEST_RESULT" == 0 ]]; then ./cc-test-reporter format-coverage -t simplecov -o ./coverage/codeclimate.$CI_NODE_INDEX.json ./coverage/spec/.resultset.json; fi
  - if [[ "$TRAVIS_TEST_RESULT" == 0 ]]; then ./cc-test-reporter sum-coverage --output - --parts $CI_NODE_TOTAL coverage/codeclimate.*.json | ./cc-test-reporter upload-coverage --input -; fi
